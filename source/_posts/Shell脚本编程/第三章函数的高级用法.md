---
title: 函数的高级用法
date: 2021-10-30
tags: [shell]
categories: shell
---

### 一、函数的定义和使用

 #### 1、语法格式

<center>格式一<center>
<img src="https://cos-1301609895.cos.ap-nanjing.myqcloud.com/Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/14%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F.png">

<center>格式二<center>
<img src="https://cos-1301609895.cos.ap-nanjing.myqcloud.com/Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/15%E8%AF%AD%E6%B3%95%E6%A0%BC%E5%BC%8F.png">

#### 2、如何调用函数

- 直接使用函数名调用，可以将其想象成Shell的一条命令
- 函数内部可以使用参数` $1、$2、$3......$n` 
- 调用函数：` function_name  $1  $2`



#### 3、示例演示

- 创建函数

```shell
Test()
{
echo "Hello Test"
}
```

- 使用函数

```
Test
```



#### 4、小脚本（nginx守护进程）

写一个nginx脚本，如果nginx服务宕掉，则该服务可以检测并且将进程重新启动；如果正常运行，则不作任何处理

```shell
#!/bin/bash
#

this_pid=$$

while true
do
ps -ef | grep nginx | grep -v grep | grep -v $this_pid &> /dev/null

if [ $? -eq 0 ];then
	echo "Nginx is running well"
	sleep 3
else
	systemctl start nginx
	echo "Nginx is down,Start it...."
fi
done
```



### 二、向函数传递参数

#### 1、Shell中传参

<img src="https://cos-1301609895.cos.ap-nanjing.myqcloud.com/Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/16shell%E4%B8%AD%E4%BC%A0%E5%8F%82.png">

 #### 2、Shell中函数调用

<img src="https://cos-1301609895.cos.ap-nanjing.myqcloud.com/Shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/17Shell%E4%B8%AD%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8.png">

#### 3、小脚本

写一个脚本，该脚本可以实现计算器的功能，可以进行` +、-、*、/`四种运算

```shell
#!/bin/bash
#

function calcu
{
	case $2 in
		+)
			echo "`expr $1 + $3`"
			;;
		-)
			echo "`expr $1 - $3`"
			;;
		\*)
			echo "`expr $1 \* $3`"
			;;
		/)
			echo "`expr $1 / $3`"
			;;
	esac
}

calcu $1 $2 $3
```



### 三、函数的返回值

#### 1、return

- 使用return返回值，只能返回1-255的整数
- 函数使用return返回值，通常只是用来供其他地方调用获取状态，因此通常返回0或1



#### 2、echo

- 返回任何字符串结果
- 通常适用于返回数据，比如一个字符串或者列表值



#### 3、小练习

获取系统中所有的用户

```shell
#!/bin/bash
#

function get_users
{
	users=`cat /etc/passwd | cut -d: -f1`
	echo $users
}

user_list=`get_users`

index=1
for u in $user_list
do
	echo "The $index user is : $u"
	index=$(($index+1))
done
```



### 四、局部变量和全局变量

- 不作任何声明，Shell中的变量都是全局变量
- 大型脚本程序中应当慎用全局变量

#### 1、局部变量的定义

定义变量时，使用` local`关键字

函数内和外若存在同名变量，则函数内部变量会覆盖外部变量  



#### 2、小脚本

```shell
#!/bin/bash
#

var1="Hello world"

function test
{
	local var2=87
}

test

echo $var1
echo $var2
```



### 五、函数库

- 经常使用的重复代码封装成函数文件
- 一般不是直接执行的，而是由其他脚本调用

#### 小脚本

